{
  "ruleChain": {
    "additionalInfo": {
      "description": "Type: Save Telemetry\nTarget Entity Type: Asset\nTarget Entity Name: G1\nInput: work_id, {in_count|success_count|fail_count}\nOutput: {all_in_count=sum(in_count)|all_success_count=sum(success_count)|all_fail_count=sum(fail_count)}"
    },
    "name": "Save G1",
    "firstRuleNodeId": null,
    "root": false,
    "debugMode": false,
    "configuration": null
  },
  "metadata": {
    "firstNodeIndex": 6,
    "nodes": [
      {
        "additionalInfo": {
          "layoutX": 1648,
          "layoutY": 251
        },
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode",
        "name": "Save Telemetry",
        "debugMode": false,
        "configuration": {
          "defaultTTL": 0
        }
      },
      {
        "additionalInfo": {
          "layoutX": 551,
          "layoutY": 150
        },
        "type": "org.thingsboard.rule.engine.action.TbCreateRelationNode",
        "name": "Change Originator",
        "debugMode": false,
        "configuration": {
          "direction": "FROM",
          "relationType": "WORKER",
          "entityType": "ASSET",
          "entityNamePattern": "${targetDeviceName}",
          "entityTypePattern": "GROUP",
          "entityCacheExpiration": 300,
          "createEntityIfNotExists": false,
          "changeOriginatorToRelatedEntity": true,
          "removeCurrentRelations": false
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1101,
          "layoutY": 252
        },
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "Get Attributes",
        "debugMode": false,
        "configuration": {
          "clientAttributeNames": [],
          "sharedAttributeNames": [],
          "serverAttributeNames": [],
          "latestTsKeyNames": [
            "datasource_in_count"
          ]
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1374,
          "layoutY": 252
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Set Message",
        "debugMode": false,
        "configuration": {
          "jsScript": "var datasource = JSON.parse(metadata.datasource_in_count || \"{}\");\nvar newMsg = {};\n\ndatasource[msg.worker_id] = msg.in_count;\n    \nnewMsg.all_in_count = 0;\nfor (var worker_id in datasource) {\n    newMsg.all_in_count += datasource[worker_id];\n}\n\nnewMsg.datasource_in_count = JSON.stringify(datasource);\n    \nreturn {msg: newMsg, metadata: metadata, msgType: msgType};"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 824,
          "layoutY": 251
        },
        "type": "org.thingsboard.rule.engine.transaction.TbSynchronizationBeginNode",
        "name": "Transaction Start",
        "debugMode": false,
        "configuration": {
          "version": 0
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1925,
          "layoutY": 251
        },
        "type": "org.thingsboard.rule.engine.transaction.TbSynchronizationEndNode",
        "name": "Transaction End",
        "debugMode": false,
        "configuration": {
          "version": 0
        }
      },
      {
        "additionalInfo": {
          "layoutX": 274,
          "layoutY": 149
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Set Metadata",
        "debugMode": false,
        "configuration": {
          "jsScript": "metadata.targetDeviceName = 'G1';\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 275,
          "layoutY": 350
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsSwitchNode",
        "name": "Switch Sensor Type",
        "debugMode": false,
        "configuration": {
          "jsScript": "return [metadata.sensorType];"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1648,
          "layoutY": 352
        },
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode",
        "name": "Save Telemetry",
        "debugMode": false,
        "configuration": {
          "defaultTTL": 0
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1101,
          "layoutY": 353
        },
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "Get Attributes",
        "debugMode": false,
        "configuration": {
          "clientAttributeNames": [],
          "sharedAttributeNames": [],
          "serverAttributeNames": [],
          "latestTsKeyNames": [
            "datasource_success_count"
          ]
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1374,
          "layoutY": 353
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Set Message",
        "debugMode": false,
        "configuration": {
          "jsScript": "var datasource = JSON.parse(metadata.datasource_success_count || \"{}\");\nvar newMsg = {};\n    \ndatasource[msg.worker_id] = msg.success_count;\n\nnewMsg.all_success_count = 0;\nfor (var worker_id in datasource) {\n    newMsg.all_success_count += datasource[worker_id];\n}\n\nnewMsg.datasource_success_count = JSON.stringify(datasource);\n    \nreturn {msg: newMsg, metadata: metadata, msgType: msgType};"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 824,
          "layoutY": 352
        },
        "type": "org.thingsboard.rule.engine.transaction.TbSynchronizationBeginNode",
        "name": "Transaction Start",
        "debugMode": false,
        "configuration": {
          "version": 0
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1925,
          "layoutY": 349
        },
        "type": "org.thingsboard.rule.engine.transaction.TbSynchronizationEndNode",
        "name": "Transaction End",
        "debugMode": false,
        "configuration": {
          "version": 0
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1650,
          "layoutY": 452
        },
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode",
        "name": "Save Telemetry",
        "debugMode": false,
        "configuration": {
          "defaultTTL": 0
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1103,
          "layoutY": 453
        },
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "Get Attributes",
        "debugMode": false,
        "configuration": {
          "clientAttributeNames": [],
          "sharedAttributeNames": [],
          "serverAttributeNames": [],
          "latestTsKeyNames": [
            "datasource_fail_count"
          ]
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1376,
          "layoutY": 453
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Set Message",
        "debugMode": false,
        "configuration": {
          "jsScript": "var datasource = JSON.parse(metadata.datasource_fail_count || \"{}\");\nvar newMsg = {};\n\ndatasource[msg.worker_id] = msg.fail_count;\n\nnewMsg.all_fail_count = 0;\nfor (var worker_id in datasource) {\n    newMsg.all_fail_count += datasource[worker_id];\n}\n\nnewMsg.datasource_fail_count = JSON.stringify(datasource);\n    \nreturn {msg: newMsg, metadata: metadata, msgType: msgType};"
        }
      },
      {
        "additionalInfo": {
          "layoutX": 826,
          "layoutY": 452
        },
        "type": "org.thingsboard.rule.engine.transaction.TbSynchronizationBeginNode",
        "name": "Transaction Start",
        "debugMode": false,
        "configuration": {
          "version": 0
        }
      },
      {
        "additionalInfo": {
          "layoutX": 1926,
          "layoutY": 449
        },
        "type": "org.thingsboard.rule.engine.transaction.TbSynchronizationEndNode",
        "name": "Transaction End",
        "debugMode": false,
        "configuration": {
          "version": 0
        }
      }
    ],
    "connections": [
      {
        "fromIndex": 0,
        "toIndex": 5,
        "type": "Success"
      },
      {
        "fromIndex": 1,
        "toIndex": 7,
        "type": "Success"
      },
      {
        "fromIndex": 2,
        "toIndex": 3,
        "type": "Failure"
      },
      {
        "fromIndex": 2,
        "toIndex": 3,
        "type": "Success"
      },
      {
        "fromIndex": 3,
        "toIndex": 0,
        "type": "Success"
      },
      {
        "fromIndex": 4,
        "toIndex": 2,
        "type": "Success"
      },
      {
        "fromIndex": 6,
        "toIndex": 1,
        "type": "Success"
      },
      {
        "fromIndex": 7,
        "toIndex": 16,
        "type": "FAIL_COUNT"
      },
      {
        "fromIndex": 7,
        "toIndex": 4,
        "type": "IN_COUNT"
      },
      {
        "fromIndex": 7,
        "toIndex": 11,
        "type": "SUCCESS_COUNT"
      },
      {
        "fromIndex": 8,
        "toIndex": 12,
        "type": "Success"
      },
      {
        "fromIndex": 9,
        "toIndex": 10,
        "type": "Failure"
      },
      {
        "fromIndex": 9,
        "toIndex": 10,
        "type": "Success"
      },
      {
        "fromIndex": 10,
        "toIndex": 8,
        "type": "Success"
      },
      {
        "fromIndex": 11,
        "toIndex": 9,
        "type": "Success"
      },
      {
        "fromIndex": 13,
        "toIndex": 17,
        "type": "Success"
      },
      {
        "fromIndex": 14,
        "toIndex": 15,
        "type": "Failure"
      },
      {
        "fromIndex": 14,
        "toIndex": 15,
        "type": "Success"
      },
      {
        "fromIndex": 15,
        "toIndex": 13,
        "type": "Success"
      },
      {
        "fromIndex": 16,
        "toIndex": 14,
        "type": "Success"
      }
    ],
    "ruleChainConnections": null
  }
}